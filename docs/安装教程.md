# å®‰è£…ä¸ä½¿ç”¨æŒ‡å—

## ç›®å½•

- [å®‰è£…ä¸ä½¿ç”¨æŒ‡å—](#å®‰è£…ä¸ä½¿ç”¨æŒ‡å—)
  - [ç›®å½•](#ç›®å½•)
  - [ç®€ä»‹](#ç®€ä»‹)
  - [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
    - [1. å®‰è£… Conda](#1-å®‰è£…-conda)
    - [2. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ](#2-åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ)
    - [3. å®‰è£…ä¾èµ–](#3-å®‰è£…ä¾èµ–)
  - [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
  - [Azure OpenAI API é…ç½®](#azure-openai-api-é…ç½®)
  - [ComfyUI é…ç½®](#comfyui-é…ç½®)
    - [1. å®‰è£… ComfyUI](#1-å®‰è£…-comfyui)
    - [2. å¯åŠ¨ ComfyUI æœåŠ¡](#2-å¯åŠ¨-comfyui-æœåŠ¡)
  - [å¯åŠ¨ä¸è®¿é—®](#å¯åŠ¨ä¸è®¿é—®)
  - [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
    - [Q: Azure OpenAI æŠ¥é”™ 401 æˆ– 403ï¼Ÿ](#q-azure-openai-æŠ¥é”™-401-æˆ–-403)
    - [Q: ComfyUI é¡µé¢æ— æ³•è®¿é—®ï¼Ÿ](#q-comfyui-é¡µé¢æ— æ³•è®¿é—®)

## ç®€ä»‹

æœ¬é¡¹ç›®é›†æˆäº† Azure OpenAI ä¸ ComfyUIï¼Œæä¾›å¼ºå¤§çš„æ¨ç†ä¸è§†è§‰å¤„ç†èƒ½åŠ›ã€‚æ­¤æ–‡æ¡£å°†æŒ‡å¯¼ä½ å®Œæˆç¯å¢ƒé…ç½®ã€API æ¥å…¥ä¸æœåŠ¡å¯åŠ¨ã€‚

## ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… Conda

è¯·è®¿é—® Conda å®˜ç½‘å®‰è£… Miniconda æˆ– Anacondaã€‚

### 2. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```bash
conda create -n AIGC python=3.10 -y
conda activate AIGC
```

### 3. å®‰è£…ä¾èµ–

ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•ä¸‹å­˜åœ¨ `requirements.txt` æ–‡ä»¶ï¼š

```bash
pip install -r requirements.txt
```

## ç¯å¢ƒå˜é‡é…ç½®

è¯·åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼Œå¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
# æ—¥å¿—ç­‰çº§ï¼Œå¯é€‰ï¼šDEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# ComfyUI æ¥å£é…ç½®
COMFYUI_BASE_API_URL=http://127.0.0.1:8188/api
COMFYUI_WEBSOCKET_API_URL=ws://127.0.0.1:8188/ws

# Azure OpenAI æ¥å£é…ç½®
AZURE_OPENAI_MODEL=gpt-4
AZURE_OPENAI_API_KEY=ä½ çš„AzureOpenAIå¯†é’¥
AZURE_OPENAI_ENDPOINT=https://ä½ çš„èµ„æºå.openai.azure.com/
AZURE_OPENAI_API_VERSION=2023-12-01-preview

# é»˜è®¤æ‰¹å¤„ç†è®¾ç½®ï¼ˆå¯ä¿æŒé»˜è®¤ï¼‰
DEFAULT_BATCHSIZE_USE_ONE_PROMPT=1

# äº§å“å›¾è½¬æµ·æŠ¥è®¾ç½®ï¼ˆå¯ä¿æŒé»˜è®¤ï¼‰
IMAGE2POSTER_BATCHSIZE_USE_ONE_PROMPT=1
IMAGE2POSTER_OUTPUT_SIZE_WIDTH=1024
IMAGE2POSTER_OUTPUT_SIZE_HEIGHT=1024
IMAGE2POSTER_SCALE_MIN=0.3
IMAGE2POSTER_SCALE_MAX=0.7
```

> ğŸ’¡ å»ºè®®ï¼šå°† `.env` æ–‡ä»¶åŠ å…¥ `.gitignore` ä»¥é¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚

## Azure OpenAI API é…ç½®

1. ç™»å½• Azure Portal
2. åˆ›å»º Azure OpenAI æœåŠ¡
3. éƒ¨ç½²æ‰€éœ€æ¨¡å‹ï¼ˆå¦‚ gpt-4, gpt-35-turboï¼Œæˆ– embedding æ¨¡å‹ï¼‰
4. è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š
   - API Key
   - Endpoint
   - API Versionï¼ˆå»ºè®®ä½¿ç”¨å®˜æ–¹æœ€æ–°ï¼‰
   - éƒ¨ç½²åç§°ï¼ˆéœ€ä¸ AZURE_OPENAI_MODEL ä¿æŒä¸€è‡´ï¼‰

## ComfyUI é…ç½®

### 1. å®‰è£… ComfyUI

```bash
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 2. å¯åŠ¨ ComfyUI æœåŠ¡

```bash
python main.py
```

æœåŠ¡åœ°å€ï¼š
- Web ç•Œé¢ï¼šhttp://127.0.0.1:8188
- API åœ°å€ï¼šhttp://127.0.0.1:8188/api
- WebSocket åœ°å€ï¼šws://127.0.0.1:8188/ws

## å¯åŠ¨ä¸è®¿é—®

ç¡®ä¿ `.env` å·²é…ç½®å¹¶ä¿å­˜ï¼ŒComfyUI æ­£åœ¨è¿è¡Œã€‚ç„¶åè¿è¡Œä½ çš„ä¸»ç¨‹åºï¼š

```bash
python main.py
```

## å¸¸è§é—®é¢˜

### Q: Azure OpenAI æŠ¥é”™ 401 æˆ– 403ï¼Ÿ

- è¯·ç¡®è®¤ API Key å’Œ Endpoint æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦å¯ç”¨äº†å¯¹åº”æ¨¡å‹
- æ£€æŸ¥ `.env` ä¸­æ¨¡å‹åç§°ä¸ Azure éƒ¨ç½²åç§°æ˜¯å¦ä¸€è‡´

### Q: ComfyUI é¡µé¢æ— æ³•è®¿é—®ï¼Ÿ

- æ£€æŸ¥æ˜¯å¦å·²è¿è¡Œ main.py
- ç¡®è®¤æœ¬åœ°æœªå ç”¨ 8188 ç«¯å£
- é˜²ç«å¢™/å®‰å…¨è½¯ä»¶æ˜¯å¦æ‹¦æˆª